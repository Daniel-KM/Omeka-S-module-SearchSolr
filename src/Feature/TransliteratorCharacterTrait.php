<?php declare(strict_types=1);

namespace SearchSolr\Feature;

trait TransliteratorCharacterTrait
{
    /**
     * Unlike sql, solr regex does not manage insensitive search, neither flag
     * "i", so when a filter query "contains" is done, this list is used.
     * Of course, it's simpler to remove diacritic during indexation.
     *
     * @link https://github.com/bcit-ci/CodeIgniter/blob/develop/application/config/foreign_chars.php
     * FIXME Use the unicode functions to map better for regex. To be removed with the multi-index. Manage multiple characters and ligatures.
     *
     * @var array
     */
    protected $regexDiacritics = [
        'a' => '[aàáâãåǻāăąǎªαάảạầấẫẩậằắẵẳặаäæǽяAÀÁÂÃÄÅǺĀĂĄǍΑΆẢẠẦẪẨẬẰẮẴẲẶАÄÆǼЯ]',
        'b' => '[bбBБ]',
        'c' => '[cçćĉċčχчCÇĆĈĊČΧЧ]',
        'd' => '[dдδðďđDДΔÐĎĐ]',
        'e' => '[eèéêëēĕėęěέεẽẻẹềếễểệеэёєEÈÉÊËĒĔĖĘĚΕΈẼẺẸỀẾỄỂỆЕЭЁЄ]',
        'f' => '[fфφƒFФΦ]',
        'g' => '[gĝğġģγгґGĜĞĠĢΓГҐ]',
        'h' => '[hĥħHĤĦ]',
        'i' => '[iìíîïĩīĭǐįıηήίιϊỉịиыїĳIÌÍÎÏĨĪĬǏĮİΗΉΊΙΪỈỊИЫĲЇ]',
        'j' => '[jĵJĴ]',
        'k' => '[kķκкхξKĶΚКΞХ]',
        'l' => '[lĺļľŀłλлLĹĻĽĿŁΛЛ]',
        'm' => '[mмμMМΜ]',
        'n' => '[nñńņňŉνнNÑŃŅŇΝН]',
        'o' => '[oòóôõōŏǒőơøǿºοόωώỏọồốỗổộờớỡởợоöœOÒÓÔÕŌŎǑŐƠØǾΟΌΩΏỎỌỒỐỖỔỘỜỚỠỞỢОÖŒ]',
        'p' => '[pпπψPПΠΨ]',
        'q' => '[qQ]',
        'r' => '[rŕŗřρрRŔŖŘΡР]',
        's' => '[sśŝşșšſσςсщшSŚŜŞȘŠΣСßЩШ]',
        't' => '[tțţťŧτтθÞþцTȚŢŤŦΤТΘЦ]',
        'u' => '[uùúûũūŭůűųưǔǖǘǚǜυύϋủụừứữửựуüюUÙÚÛŨŪŬŮŰŲƯǓǕǗǙǛŨỦỤỪỨỮỬỰУÜЮ]',
        'v' => '[vвβVВΒ]',
        'w' => '[wŵWŴ]',
        'x' => '[xX]',
        'y' => '[yẙʏƴɏỵẏӳӯўýÿŷỳỹỷỵйYƳɎỴẎӲӮЎÝŸŶΥΎΫỲỸỶỴЙ]',
        'z' => '[zźżžζзжZŹŻŽΖЗЖ]',
    ];

    protected $regexLowerDiacritics = [
        'a' => '[aàáâãåǻāăąǎªαάảạầấẫẩậằắẵẳặаäæǽя]',
        'b' => '[bб]',
        'c' => '[cçćĉċčχч]',
        'd' => '[dдδðďđ]',
        'e' => '[eèéêëēĕėęěέεẽẻẹềếễểệеэёє]',
        'f' => '[fфφƒ]',
        'g' => '[gĝğġģγгґ]',
        'h' => '[hĥħ]',
        'i' => '[iìíîïĩīĭǐįıηήίιϊỉịиыїĳ]',
        'j' => '[jĵ]',
        'k' => '[kķκкхξ]',
        'l' => '[lĺļľŀłλл]',
        'm' => '[mмμ]',
        'n' => '[nñńņňŉνн]',
        'o' => '[oòóôõōŏǒőơøǿºοόωώỏọồốỗổộờớỡởợоöœ]',
        'p' => '[pпπψ]',
        'q' => '[q]',
        'r' => '[rŕŗřρр]',
        's' => '[sśŝşșšſσςсщш]',
        't' => '[tțţťŧτтθÞþц]',
        'u' => '[uùúûũūŭůűųưǔǖǘǚǜυύϋủụừứữửựуüю]',
        'v' => '[vвβ]',
        'w' => '[wŵ]',
        'x' => '[x]',
        'y' => '[yẙʏƴɏỵẏӳӯўýÿŷỳỹỷỵй]',
        'z' => '[zźżžζзж]',
    ];

    protected $regexUpperDiacritics = [
        'a' => '[AÀÁÂÃÄÅǺĀĂĄǍΑΆẢẠẦẪẨẬẰẮẴẲẶАÄÆǼЯ]',
        'b' => '[BБ]',
        'c' => '[CÇĆĈĊČΧЧ]',
        'd' => '[DДΔÐĎĐ]',
        'e' => '[EÈÉÊËĒĔĖĘĚΕΈẼẺẸỀẾỄỂỆЕЭЁЄ]',
        'f' => '[FФΦ]',
        'g' => '[GĜĞĠĢΓГҐ]',
        'h' => '[HĤĦ]',
        'i' => '[IÌÍÎÏĨĪĬǏĮİΗΉΊΙΪỈỊИЫĲЇ]',
        'j' => '[JĴ]',
        'k' => '[KĶΚКΞХ]',
        'l' => '[LĹĻĽĿŁΛЛ]',
        'm' => '[MМΜ]',
        'n' => '[NÑŃŅŇΝН]',
        'o' => '[OÒÓÔÕŌŎǑŐƠØǾΟΌΩΏỎỌỒỐỖỔỘỜỚỠỞỢОÖŒ]',
        'p' => '[PПΠΨ]',
        'q' => '[Q]',
        'r' => '[RŔŖŘΡР]',
        's' => '[SŚŜŞȘŠΣСßЩШ]',
        't' => '[TȚŢŤŦΤТΘЦ]',
        'u' => '[UÙÚÛŨŪŬŮŰŲƯǓǕǗǙǛŨỦỤỪỨỮỬỰУÜЮ]',
        'v' => '[VВΒ]',
        'w' => '[WŴ]',
        'x' => '[X]',
        'y' => '[YƳɎỴẎӲӮЎÝŸŶΥΎΫỲỸỶỴЙ]',
        'z' => '[ZŹŻŽΖЗЖ]',
    ];

    /**
     * @link https://stackoverflow.com/a/58041582/7103991
     *
     * FIXME Only the first character is converted, even if it is enough currently.
     *
     * @var array
     */
    protected $baseDiacritics = [
        'À' => 'A',
        'Á' => 'A',
        'Â' => 'A',
        'Ã' => 'A',
        'Ä' => 'A',
        'Å' => 'A',
        'Æ' => 'AE',
        'Ç' => 'C',
        'È' => 'E',
        'É' => 'E',
        'Ê' => 'E',
        'Ë' => 'E',
        'Ì' => 'I',
        'Í' => 'I',
        'Î' => 'I',
        'Ï' => 'I',
        'Ð' => 'ETH',
        'Ñ' => 'N',
        'Ò' => 'O',
        'Ó' => 'O',
        'Ô' => 'O',
        'Õ' => 'O',
        'Ö' => 'O',
        'Ø' => 'O',
        'Ù' => 'U',
        'Ú' => 'U',
        'Û' => 'U',
        'Ü' => 'U',
        'Ý' => 'Y',
        'Þ' => 'THORN',
        'ß' => 's',
        'à' => 'a',
        'á' => 'a',
        'â' => 'a',
        'ã' => 'a',
        'ä' => 'a',
        'å' => 'a',
        'æ' => 'ae',
        'ç' => 'c',
        'è' => 'e',
        'é' => 'e',
        'ê' => 'e',
        'ë' => 'e',
        'ì' => 'i',
        'í' => 'i',
        'î' => 'i',
        'ï' => 'i',
        'ð' => 'eth',
        'ñ' => 'n',
        'ò' => 'o',
        'ó' => 'o',
        'ô' => 'o',
        'õ' => 'o',
        'ö' => 'o',
        'ø' => 'o',
        'ù' => 'u',
        'ú' => 'u',
        'û' => 'u',
        'ü' => 'u',
        'ý' => 'y',
        'þ' => 'thorn',
        'ÿ' => 'y',
        'Ā' => 'A',
        'ā' => 'a',
        'Ă' => 'A',
        'ă' => 'a',
        'Ą' => 'A',
        'ą' => 'a',
        'Ć' => 'C',
        'ć' => 'c',
        'Ĉ' => 'C',
        'ĉ' => 'c',
        'Ċ' => 'C',
        'ċ' => 'c',
        'Č' => 'C',
        'č' => 'c',
        'Ď' => 'D',
        'ď' => 'd',
        'Đ' => 'D',
        'đ' => 'd',
        'Ē' => 'E',
        'ē' => 'e',
        'Ĕ' => 'E',
        'ĕ' => 'e',
        'Ė' => 'E',
        'ė' => 'e',
        'Ę' => 'E',
        'ę' => 'e',
        'Ě' => 'E',
        'ě' => 'e',
        'Ĝ' => 'G',
        'ĝ' => 'g',
        'Ğ' => 'G',
        'ğ' => 'g',
        'Ġ' => 'G',
        'ġ' => 'g',
        'Ģ' => 'G',
        'ģ' => 'g',
        'Ĥ' => 'H',
        'ĥ' => 'h',
        'Ħ' => 'H',
        'ħ' => 'h',
        'Ĩ' => 'I',
        'ĩ' => 'i',
        'Ī' => 'I',
        'ī' => 'i',
        'Ĭ' => 'I',
        'ĭ' => 'i',
        'Į' => 'I',
        'į' => 'i',
        'İ' => 'I',
        'ı' => 'i',
        'Ĵ' => 'J',
        'ĵ' => 'j',
        'Ķ' => 'K',
        'ķ' => 'k',
        'ĸ' => 'kra',
        'Ĺ' => 'L',
        'ĺ' => 'l',
        'Ļ' => 'L',
        'ļ' => 'l',
        'Ľ' => 'L',
        'ľ' => 'l',
        'Ŀ' => 'L',
        'ŀ' => 'l',
        'Ł' => 'L',
        'ł' => 'l',
        'Ń' => 'N',
        'ń' => 'n',
        'Ņ' => 'N',
        'ņ' => 'n',
        'Ň' => 'N',
        'ň' => 'n',
        'ŉ' => 'n',
        'Ŋ' => 'ENG',
        'ŋ' => 'eng',
        'Ō' => 'O',
        'ō' => 'o',
        'Ŏ' => 'O',
        'ŏ' => 'o',
        'Ő' => 'O',
        'ő' => 'o',
        'Ŕ' => 'R',
        'ŕ' => 'r',
        'Ŗ' => 'R',
        'ŗ' => 'r',
        'Ř' => 'R',
        'ř' => 'r',
        'Ś' => 'S',
        'ś' => 's',
        'Ŝ' => 'S',
        'ŝ' => 's',
        'Ş' => 'S',
        'ş' => 's',
        'Š' => 'S',
        'š' => 's',
        'Ţ' => 'T',
        'ţ' => 't',
        'Ť' => 'T',
        'ť' => 't',
        'Ŧ' => 'T',
        'ŧ' => 't',
        'Ũ' => 'U',
        'ũ' => 'u',
        'Ū' => 'U',
        'ū' => 'u',
        'Ŭ' => 'U',
        'ŭ' => 'u',
        'Ů' => 'U',
        'ů' => 'u',
        'Ű' => 'U',
        'ű' => 'u',
        'Ų' => 'U',
        'ų' => 'u',
        'Ŵ' => 'W',
        'ŵ' => 'w',
        'Ŷ' => 'Y',
        'ŷ' => 'y',
        'Ÿ' => 'Y',
        'Ź' => 'Z',
        'ź' => 'z',
        'Ż' => 'Z',
        'ż' => 'z',
        'Ž' => 'Z',
        'ž' => 'z',
        'ſ' => 's',
        'ƀ' => 'b',
        'Ɓ' => 'B',
        'Ƃ' => 'B',
        'ƃ' => 'b',
        'Ƅ' => 'SIX',
        'ƅ' => 'six',
        'Ɔ' => 'O',
        'Ƈ' => 'C',
        'ƈ' => 'c',
        'Ɖ' => 'D',
        'Ɗ' => 'D',
        'Ƌ' => 'D',
        'ƌ' => 'd',
        'ƍ' => 'delta',
        'Ǝ' => 'E',
        'Ə' => 'SCHWA',
        'Ɛ' => 'E',
        'Ƒ' => 'F',
        'ƒ' => 'f',
        'Ɠ' => 'G',
        'Ɣ' => 'GAMMA',
        'ƕ' => 'hv',
        'Ɩ' => 'IOTA',
        'Ɨ' => 'I',
        'Ƙ' => 'K',
        'ƙ' => 'k',
        'ƚ' => 'l',
        'ƛ' => 'lambda',
        'Ɯ' => 'M',
        'Ɲ' => 'N',
        'ƞ' => 'n',
        'Ɵ' => 'O',
        'Ơ' => 'O',
        'ơ' => 'o',
        'Ƣ' => 'OI',
        'ƣ' => 'oi',
        'Ƥ' => 'P',
        'ƥ' => 'p',
        'Ƨ' => 'TWO',
        'ƨ' => 'two',
        'Ʃ' => 'ESH',
        'ƫ' => 't',
        'Ƭ' => 'T',
        'ƭ' => 't',
        'Ʈ' => 'T',
        'Ư' => 'U',
        'ư' => 'u',
        'Ʊ' => 'UPSILON',
        'Ʋ' => 'V',
        'Ƴ' => 'Y',
        'ƴ' => 'y',
        'Ƶ' => 'Z',
        'ƶ' => 'z',
        'Ʒ' => 'EZH',
        'Ƹ' => 'EZH',
        'ƹ' => 'ezh',
        'ƺ' => 'ezh',
        'Ƽ' => 'FIVE',
        'ƽ' => 'five',
        'Ǆ' => 'DZ',
        'ǅ' => 'D',
        'ǆ' => 'dz',
        'Ǉ' => 'LJ',
        'ǈ' => 'L',
        'ǉ' => 'lj',
        'Ǌ' => 'NJ',
        'ǋ' => 'N',
        'ǌ' => 'nj',
        'Ǎ' => 'A',
        'ǎ' => 'a',
        'Ǐ' => 'I',
        'ǐ' => 'i',
        'Ǒ' => 'O',
        'ǒ' => 'o',
        'Ǔ' => 'U',
        'ǔ' => 'u',
        'Ǖ' => 'U',
        'ǖ' => 'u',
        'Ǘ' => 'U',
        'ǘ' => 'u',
        'Ǚ' => 'U',
        'ǚ' => 'u',
        'Ǜ' => 'U',
        'ǜ' => 'u',
        'ǝ' => 'e',
        'Ǟ' => 'A',
        'ǟ' => 'a',
        'Ǡ' => 'A',
        'ǡ' => 'a',
        'Ǣ' => 'AE',
        'ǣ' => 'ae',
        'Ǥ' => 'G',
        'ǥ' => 'g',
        'Ǧ' => 'G',
        'ǧ' => 'g',
        'Ǩ' => 'K',
        'ǩ' => 'k',
        'Ǫ' => 'O',
        'ǫ' => 'o',
        'Ǭ' => 'O',
        'ǭ' => 'o',
        'Ǯ' => 'EZH',
        'ǯ' => 'ezh',
        'ǰ' => 'j',
        'Ǳ' => 'DZ',
        'ǲ' => 'D',
        'ǳ' => 'dz',
        'Ǵ' => 'G',
        'ǵ' => 'g',
        'Ƕ' => 'HWAIR',
        'Ƿ' => 'WYNN',
        'Ǹ' => 'N',
        'ǹ' => 'n',
        'Ǻ' => 'A',
        'ǻ' => 'a',
        'Ǽ' => 'AE',
        'ǽ' => 'ae',
        'Ǿ' => 'O',
        'ǿ' => 'o',
        'Ȁ' => 'A',
        'ȁ' => 'a',
        'Ȃ' => 'A',
        'ȃ' => 'a',
        'Ȅ' => 'E',
        'ȅ' => 'e',
        'Ȇ' => 'E',
        'ȇ' => 'e',
        'Ȉ' => 'I',
        'ȉ' => 'i',
        'Ȋ' => 'I',
        'ȋ' => 'i',
        'Ȍ' => 'O',
        'ȍ' => 'o',
        'Ȏ' => 'O',
        'ȏ' => 'o',
        'Ȑ' => 'R',
        'ȑ' => 'r',
        'Ȓ' => 'R',
        'ȓ' => 'r',
        'Ȕ' => 'U',
        'ȕ' => 'u',
        'Ȗ' => 'U',
        'ȗ' => 'u',
        'Ș' => 'S',
        'ș' => 's',
        'Ț' => 'T',
        'ț' => 't',
        'Ȝ' => 'YOGH',
        'ȝ' => 'yogh',
        'Ȟ' => 'H',
        'ȟ' => 'h',
        'Ƞ' => 'N',
        'ȡ' => 'd',
        'Ȣ' => 'OU',
        'ȣ' => 'ou',
        'Ȥ' => 'Z',
        'ȥ' => 'z',
        'Ȧ' => 'A',
        'ȧ' => 'a',
        'Ȩ' => 'E',
        'ȩ' => 'e',
        'Ȫ' => 'O',
        'ȫ' => 'o',
        'Ȭ' => 'O',
        'ȭ' => 'o',
        'Ȯ' => 'O',
        'ȯ' => 'o',
        'Ȱ' => 'O',
        'ȱ' => 'o',
        'Ȳ' => 'Y',
        'ȳ' => 'y',
        'ȴ' => 'l',
        'ȵ' => 'n',
        'ȶ' => 't',
        'ȷ' => 'j',
        'ȸ' => 'db',
        'ȹ' => 'qp',
        'Ⱥ' => 'A',
        'Ȼ' => 'C',
        'ȼ' => 'c',
        'Ƚ' => 'L',
        'Ⱦ' => 'T',
        'ȿ' => 's',
        'ɀ' => 'z',
        'Ɂ' => 'STOP',
        'ɂ' => 'stop',
        'Ƀ' => 'B',
        'Ʉ' => 'U',
        'Ʌ' => 'V',
        'Ɇ' => 'E',
        'ɇ' => 'e',
        'Ɉ' => 'J',
        'ɉ' => 'j',
        'Ɋ' => 'Q',
        'ɋ' => 'q',
        'Ɍ' => 'R',
        'ɍ' => 'r',
        'Ɏ' => 'Y',
        'ɏ' => 'y',
        'ɐ' => 'a',
        'ɑ' => 'alpha',
        'ɒ' => 'alpha',
        'ɓ' => 'b',
        'ɔ' => 'o',
        'ɕ' => 'c',
        'ɖ' => 'd',
        'ɗ' => 'd',
        'ɘ' => 'e',
        'ə' => 'schwa',
        'ɚ' => 'schwa',
        'ɛ' => 'e',
        'ɜ' => 'e',
        'ɝ' => 'e',
        'ɞ' => 'e',
        'ɟ' => 'j',
        'ɠ' => 'g',
        'ɡ' => 'script',
        'ɣ' => 'gamma',
        'ɤ' => 'rams',
        'ɥ' => 'h',
        'ɦ' => 'h',
        'ɧ' => 'heng',
        'ɨ' => 'i',
        'ɩ' => 'iota',
        'ɫ' => 'l',
        'ɬ' => 'l',
        'ɭ' => 'l',
        'ɮ' => 'lezh',
        'ɯ' => 'm',
        'ɰ' => 'm',
        'ɱ' => 'm',
        'ɲ' => 'n',
        'ɳ' => 'n',
        'ɵ' => 'barred',
        'ɷ' => 'omega',
        'ɸ' => 'phi',
        'ɹ' => 'r',
        'ɺ' => 'r',
        'ɻ' => 'r',
        'ɼ' => 'r',
        'ɽ' => 'r',
        'ɾ' => 'r',
        'ɿ' => 'r',
        'ʂ' => 's',
        'ʃ' => 'esh',
        'ʄ' => 'j',
        'ʅ' => 'squat',
        'ʆ' => 'esh',
        'ʇ' => 't',
        'ʈ' => 't',
        'ʉ' => 'u',
        'ʊ' => 'upsilon',
        'ʋ' => 'v',
        'ʌ' => 'v',
        'ʍ' => 'w',
        'ʎ' => 'y',
        'ʐ' => 'z',
        'ʑ' => 'z',
        'ʒ' => 'ezh',
        'ʓ' => 'ezh',
        'ʚ' => 'e',
        'ʞ' => 'k',
        'ʠ' => 'q',
        'ʣ' => 'dz',
        'ʤ' => 'dezh',
        'ʥ' => 'dz',
        'ʦ' => 'ts',
        'ʧ' => 'tesh',
        'ʨ' => 'tc',
        'ʩ' => 'feng',
        'ʪ' => 'ls',
        'ʫ' => 'lz',
        'ʮ' => 'h',
        'ʯ' => 'h',

        // First letter only.
        'Æ' => 'A',
        'Ð' => 'D',
        'Þ' => 'T',
        'æ' => 'a',
        'ð' => 'd',
        'þ' => 't',
        'ĸ' => 'k',
        'Ŋ' => 'N',
        'ŋ' => 'n',
        'Ƅ' => '6',
        'ƅ' => '6',
        'ƍ' => 'd',
        'Ə' => 'S',
        'Ɣ' => 'G',
        'ƕ' => 'h',
        'Ɩ' => 'I',
        'ƛ' => 'l',
        'Ƣ' => 'O',
        'ƣ' => 'o',
        'Ƨ' => '2',
        'ƨ' => '2',
        'Ʃ' => 'S',
        'Ʊ' => 'U',
        'Ʒ' => 'E',
        'Ƹ' => 'E',
        'ƹ' => 'e',
        'ƺ' => 'e',
        'Ƽ' => '5',
        'ƽ' => '5',
        'Ǆ' => 'D',
        'ǆ' => 'd',
        'Ǉ' => 'L',
        'ǉ' => 'l',
        'Ǌ' => 'N',
        'ǋ' => 'N',
        'ǌ' => 'n',
        'ǌ' => 'n',
        'Ǣ' => 'A',
        'ǣ' => 'a',
        'Ǯ' => 'E',
        'ǯ' => 'e',
        'Ǳ' => 'D',
        'ǳ' => 'd',
        'Ƕ' => 'H',
        'Ƿ' => 'W',
        'Ǽ' => 'A',
        'ǽ' => 'a',
        'Ȝ' => 'Y',
        'ȝ' => 'y',
        'Ȣ' => 'O',
        'ȣ' => 'o',
        'ȸ' => 'd',
        'ȹ' => 'q',
        'Ɂ' => 'S',
        'ɂ' => 's',
        'ɑ' => 'a',
        'ɒ' => 'a',
        'ə' => 's',
        'ɚ' => 's',
        'ɡ' => 's',
        'ɣ' => 'g',
        'ɤ' => 'r',
        'ɧ' => 'h',
        'ɩ' => 'i',
        'ɮ' => 'l',
        'ɵ' => 'b',
        'ɷ' => 'o',
        'ɸ' => 'p',
        'ʃ' => 'e',
        'ʅ' => 's',
        'ʆ' => 'e',
        'ʊ' => 'u',
        'ʒ' => 'e',
        'ʓ' => 'e',
        'ʣ' => 'd',
        'ʤ' => 'd',
        'ʥ' => 'd',
        'ʦ' => 't',
        'ʧ' => 't',
        'ʨ' => 't',
        'ʩ' => 'f',
    ];

    /**
     * FIXME Manage diacritics with multiple characters ("œ") (or index basic strings to search them).
     *
     * @param string $string
     * @return string
     */
    protected function latinize($string)
    {
        /*
        static $transliterator;
        if (extension_loaded('intl')) {
            if (is_null($transliterator)) {
                $transliterator = \Transliterator::createFromRules(':: NFD; :: [:Nonspacing Mark:] Remove; :: NFC;');
            }
            return $transliterator->transliterate($string);
        }
        */

        // For solr regex, use only first character to simplify the pattern.
        // To split the string by character?
        return str_replace(array_keys($this->baseDiacritics), array_values($this->baseDiacritics), $string);
    }
}
